<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      :root {
        --dark: #001747;
        --gray: #b1bacb;
        --gray-border: rgba(100, 210, 210, 0.75);
        --gray-light: #eeeeee;
        --gray-dark: $405175;

        --blue: #2d70fd;
        --green: #44b858;
        --white: #ffffff;
      }

      body {
        /*background: var(--green);*/
        top: 0;
        margin: 0rem 1rem 0rem 1rem;
        /*min-height: 45rem;*/
        height: 85vh;
        display: flex;
        flex-direction: column;
        /*justify-content: space-evenly;*/
        align-items: center;
      }

      .btn {
        color: var(--white);
        font-size: 1rem;
        padding: 0.3rem 0.3rem;
        border-radius: 0.3rem;
        background-color: var(--green);
        border: none;
        position: absolute;
        right: 50%;
        bottom: 0.25rem;
      }

      .nextTenButton {
        color: var(--white);
        font-size: 1rem;
        padding: 0.3rem 0.3rem;
        border-radius: 0.3rem;
        background-color: var(--green);
        border: none;
        position: absolute;
        right: 35%;
        bottom: 0.25rem;
      }

      .clearButton {
        color: var(--white);
        font-size: 1rem;
        padding: 0.3rem 0.3rem;
        border-radius: 0.3rem;
        background-color: var(--green);
        border: none;
        position: absolute;
        right: 18%;
        bottom: 0.25rem;
      }

      .playButton {
        color: var(--white);
        font-size: 1rem;
        padding: 0.3rem 0.3rem;
        border-radius: 0.3rem;
        background-color: var(--green);
        border: none;
        position: absolute;
        right: 5%;
        bottom: 0.25rem;
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6,
      p {
        margin: 0;
      }

      /* Player Container */
      .player {
        display: flex;
        flex-direction: column;
        /*justify-content: space-around;*/
        border-radius: 1rem;
        background: var(--white);
        padding: 1rem;
        height: 80vh;
        width: 100%;
        /*box-shadow: 0 1rem 3rem 1rem rgba(0, 23, 71, 0.15);*/
        max-width: 30rem;
      }

      h2 {
        text-transform: uppercase;
        height: 2rem;
        color: var(--dark);
        text-align: center;
      }

      .playerlists {
        display: flex;
        flex-direction: row;
        width: 10rem;
        /*height: 80vh ;*/
      }

      .input {
        position: relative;
        display: flex;
      }

      .input-field {
        width: 48%;
        border: 0.06rem solid #d2d2d2bf;
        border-radius: 0.5rem;
        padding: 0.5rem;
        font-size: 1rem;
      }

      input[type="text"]::placeholder {
        color: var(--gray);
      }

      .player-container {
        display: flex;
        gap: 1rem;
      }

      ul {
        padding: 0;
        margin: 0;
        overflow-y: scroll;
      }

      li {
        display: flex;
        flex-direction: column;
        gap: 0rem;
        padding: 0.5rem;
      }

      #playerList p {
        display: flex;
        /*gap: 1rem;*/
        color: var(--dark);
        align-items: center;
      }

      #currentGameList p {
        padding: .25rem;
        display: flex;
        /*gap: 1rem;*/
        color: var(--dark);
        align-items: center;
      }

      #playerList .disabled {
        color: var(--green);
      }

      .disabled {
        display: flex;
      }

      input[type="checkbox"] {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        cursor: pointer;
      }

      input[type="checkbox"]::before {
        content: "\2713";
        display: inline-block;
        width: 1rem;
        height: 1rem;
        font-size: 1rem;
        text-align: center;
        border: 0.06rem solid var(--gray-border);
        border-radius: 50%;
        color: transparent;
      }

      input[type="checkbox"]:checked::before {
        color: var(--white);
        background-color: var(--green);
        border: 0.06rem solid var(--green);
        border-radius: 50%;
      }

      .counter {
        border: 0.06rem solid var(--gray-light);
      }

      .counter-container {
        height: 2rem;
        display: flex;
        justify-content: space-between;
      }

      .counter-container p {
        align-self: center;
      }

      .counter-container button {
        border: none;
        background-color: var(--green);
        color: var(--white);
        font-size: 1rem;
        border-radius: 0.3rem;
      }

      .scroll {
        height: 75vh;
        width: 12rem;
        scrollbar-width: thin;
      }

      .scroll::-webkit-scrollbar {
        width: 0.6rem;
      }

      .scroll::-webkit-scrollbar-thumb {
        background-color: var(--green);
        border-radius: 0.5rem;
      }

      .scroll::-webkit-scrollbar-track {
        display: none;
      }
    </style>
    <title>Basketball</title>
  </head>
  <body>
    <section class="player">
      <h2>Basketball CheckIn</h2>
      <div class="input">
        <input
          type="text"
          class="input-field"
          id="playerInput"
          placeholder="Add a new player"
        />
        <button class="btn">Add</button>
        <button class="nextTenButton">Next</button>
        <button class="clearButton">Clear</button>
        <button class="playButton">Play</button>
      </div>
      <div class="playerlists">
        <div>
          <ul class="scroll">
            <li id="playerList"></li>
          </ul>
        </div>
        <div>
          <ul
            style="
              width: 10rem;
              overflow: hidden;
              border-left: solid;
              height: 100%;
            "
          >
            <li>Current Game Players</li>
            <li id="currentGameList"></li>
          </ul>
        </div>
      </div>
      <div>
        <hr class="counter" />
        <div class="counter-container">
          <p><span id="playerCount">0</span> players total</p>
          <button id="undoButton">Undo</button>
          <button id="leaveButton">Left</button>
          <button id="leftButton">Show Left</button>
          <button id="resetAllButton">Reset</button>
        </div>
      </div>
    </section>
  </body>
  <script>
    let player = JSON.parse(localStorage.getItem("player")) || [];
    let playerBackup = JSON.parse(localStorage.getItem("playerBackup")) || [];
    let playerTemp = JSON.parse(localStorage.getItem("playerTemp")) || [];
    let leave = JSON.parse(localStorage.getItem("leave")) || [];
    let leaveBackup = JSON.parse(localStorage.getItem("leaveBackup")) || [];
    let currentPlayers =
      JSON.parse(localStorage.getItem("currentPlayers")) || [];
    const playerInput = document.getElementById("playerInput");
    const playerList = document.getElementById("playerList");
    const currentGameList = document.getElementById("currentGameList");
    const playerCount = document.getElementById("playerCount");
    const addButton = document.querySelector(".btn");
    const nextTenButton = document.querySelector(".nextTenButton");
    const leaveButton = document.getElementById("leaveButton");
    const leftButton = document.getElementById("leftButton");
    const resetAllButton = document.getElementById("resetAllButton");
    const playButton = document.querySelector(".playButton");
    const clearButton = document.querySelector(".clearButton");
    const undoButton = document.getElementById("undoButton");
    let isTen = false;

    document.addEventListener("DOMContentLoaded", function () {
      addButton.addEventListener("click", addTask);
      playerInput.addEventListener("keydown", function (event) {
        if (event.key === "Enter") {
          event.preventDefault(); // Prevents default Enter key behavior
          addTask();
        }
      });
      leaveButton.addEventListener("click", leaveAllChecked);
      leftButton.addEventListener("click", showLeft);
      resetAllButton.addEventListener("click", resetAll);
      playButton.addEventListener("click", playGame);
      nextTenButton.addEventListener("click", nextTen);
      clearButton.addEventListener("click", clearChecked);
      undoButton.addEventListener("click", undoTask);
      displayTasks();
    });

    //Add the name in the Input Field to the Player List
    //it will place them after the last player that hasn't played a game
    //this may be the top of the list if everyone has played a game
    function addTask() {
      const newTask = playerInput.value.trim();
      if (newTask !== "") {
        if (player.length === 0) {
          player.push({ text: newTask, disabled: false, gamesPlayed: 0 });
        } else {
          if (player[player.length - 1].gamesPlayed === 0) {
            player.push({ text: newTask, disabled: false, gamesPlayed: 0 });
          } else {
            for (let i = 0; i < player.length; i++) {
              if (player[i].gamesPlayed !== 0) {
                player.splice(i, 0, {
                  text: newTask,
                  disabled: false,
                  gamesPlayed: 0,
                });
                break;
              }
            }
          }
        }
        playerInput.value = "";
        saveToLocalStorage();
        displayTasks();
      }
    }

    //Display the list of Players
    function displayTasks() {
      playerList.innerHTML = "";
      player.forEach((item, index) => {
        const p = document.createElement("p");
        p.innerHTML = `
        <div class="player-container">
          <input type="checkbox" class="player-checkbox" id="input-${index}" ${
          item.disabled ? "checked" : ""
        }>
          <p id="player-${index}" class="${
          item.disabled ? "disabled" : ""
        }" onclick="editTask(${index})">${item.text}   ${item.gamesPlayed}</p>
        </div>
      `;
        p.querySelector(".player-checkbox").addEventListener("change", () =>
          toggleTask(index)
        );
        playerList.appendChild(p);
      });
      playerCount.textContent = player.length;
    }

    //Display Players in the Current Game
    function displayPlayers() {
      currentGameList.innerHTML = "";
      currentPlayers.forEach((item, index) => {
        player[index];
        const p = document.createElement("p");
        p.innerHTML = `
        <div class="player-container">
          <class="player-checkbox" id="input-${index}">
          <p id="player-${index}" class="${
          item.disabled ? "disabled" : ""
        }editTask(${index})">${item.text}   ${item.gamesPlayed + 1}</p>
        </div>
      `;
        p.querySelector(".player-checkbox");
        currentGameList.appendChild(p);
      });
    }

    //Edit a player Name that is already in the list
    function editTask(index) {
      const playerItem = document.getElementById(`player-${index}`);
      const existingText = player[index].text;
      const inputElement = document.createElement("input");

      inputElement.value = existingText;
      playerItem.replaceWith(inputElement);
      inputElement.focus();

      inputElement.addEventListener("blur", function () {
        const updatedText = inputElement.value.trim();

        if (updatedText) {
          player[index].text = updatedText;
          saveToLocalStorage();
        }
        displayTasks();
      });
    }

    //for on-click events to change the status of the checkbox and save
    function toggleTask(index) {
      player[index].disabled = !player[index].disabled;
      saveToLocalStorage();
      displayTasks();
    }

    //clear the check on all players in the current list
    function clearChecked() {
      for (let i = 0; i < player.length; i++) {
        player[i].disabled = false;
      }
      saveToLocalStorage();
      displayTasks();
    }

    //select the next 10 players on the list
    function nextTen() {
      clearChecked();
      let maxPlayers = 0;
      if (player.length < 10) {
        maxPlayers = player.length;
      } else {
        maxPlayers = 10;
      }
      for (let i = 0; i < maxPlayers; i++) {
        player[i].disabled = true;
      }
      saveToLocalStorage();
      displayTasks();
    }

    //pulls the data from backup at the sametime replacing the backup with the current player list 
    //in case the backup was not really what was required added support fot the players who left
    function undoTask() {
      playerTemp = [...player];
      player = [...playerBackup];
      playerBackup = [...playerTemp];

      playerTemp = [...leave];
      leave = [...leaveBackup];
      leaveBackup = [...playerTemp];

      saveToLocalStorage();
      saveleaveToLocalStorage();
      displayTasks();
      displayPlayers();
    }

    //creates a backup then copyies the checked players to the right side
    //then moves the checked players to the bottom of the list unchecked
    //added a test to check for 10 players selected currently requires 
    //clicking play again.
    function playGame() {
      playerBackup = [...player];
      leaveBackup = [...leave];
      currentPlayers = [];
      for (let i = 0; i < player.length; i++) {
        if (player[i].disabled) {
          let copyPlayerText = player[i].text;
          let copyPlayerGames = player[i].gamesPlayed + 1;
          player.splice(i, 1);
          i--;
          player.push({
            text: copyPlayerText,
            disabled: false,
            gamesPlayed: copyPlayerGames,
          });
          currentPlayers.push({
            text: copyPlayerText,
            gamesPlayed: copyPlayerGames,
          });
        }
      }
      if (isTen === false) {
        console.log(isTen);
        if (currentPlayers.length !== 10) {
          console.log(currentPlayers.length);
          player = [...playerBackup];
          isTen = true;
          //popup ask if should continue right now does nothing
        } else {
          displayPlayers();
          isTen = false;
        }
      } else {
        displayPlayers();
        isTen = false;
      }
      saveToLocalStorage();
      displayTasks();
    }

    //copies any checked player to the leave list which are players who do not want to play anymore (potentially could come back in)
    function leaveAllChecked() {
      leaveBackup = [...leave];
      playerBackup = [...player];
      for (let i = 0; i < player.length; i++) {
        if (player[i].disabled) {
          let x = player[i].text;
          let y = player[i].gamesPlayed;
          leave.push({ text: x, disabled: false, gamesPlayed: y });
          player.splice(i, 1);
          i--;
        }
      }
      saveToLocalStorage();
      saveleaveToLocalStorage();
      displayTasks();
    }

    //switch to showing those players that have left (current method is to copy the players to the current list and the current players to leave, button switches to show active
    function showLeft() {
      playerTemp = [...player];
      player = [...leave];
      leave = [...playerTemp];
      saveToLocalStorage();
      saveleaveToLocalStorage();
      displayTasks();
      if (leftButton.innerHTML !== "Show Active") {
        nextTenButton.disabled = true;
        nextTenButton.style.backgroundColor = "gray";
        playButton.disabled = true;
        playButton.style.backgroundColor = "gray";
        undoButton.disabled = true;
        undoButton.style.backgroundColor = "gray";
        resetAllButton.disabled = true;
        resetAllButton.style.backgroundColor = "gray";
        addButton.disabled = true;
        addButton.style.backgroundColor = "gray";
        console.log("made it here");
        leaveButton.innerHTML = "Active";
        leftButton.innerHTML = "Show Active";
      } else {
        nextTenButton.disabled = false;
        var btncolor = window
          .getComputedStyle(leaveButton, null)
          .getPropertyValue("background-color");
        nextTenButton.style.backgroundColor = btncolor;
        playButton.disabled = false;
        playButton.style.backgroundColor = btncolor;
        undoButton.disabled = false;
        undoButton.style.backgroundColor = btncolor;
        resetAllButton.disabled = false;
        resetAllButton.style.backgroundColor = btncolor;
        addButton.disabled = false;
        addButton.style.backgroundColor = btncolor;
        leaveButton.innerHTML = "Left";
        leftButton.innerHTML = "Show Left";
      }
    }

    //resets the two main arrays after making a copy of the current players so it could be undone 
    // if pressed by mistake (only if the player list is not erased or this would erase the backup)
    function resetAll() {
      if (player.length !== 0) {
        playerBackup = [...player];
        leaveBackup = [...leave];
        player = [];
        leave = [];
        saveToLocalStorage();
        saveleaveToLocalStorage();
        displayTasks();
        currentGameList.innerHTML = "";
      }
    }

    //saves the player list
    function saveToLocalStorage() {
      localStorage.setItem("player", JSON.stringify(player));
    }

    //saves the player who left or "leave" list
    function saveleaveToLocalStorage() {
      localStorage.setItem("leave", JSON.stringify(leave));
    }
  </script>
</html>
