<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      :root {
        --dark: #001747;
        --gray: #b1bacb;
        --gray-border: rgba(100, 210, 210, 0.75);
        --gray-light: #eeeeee;
        --gray-dark: $405175;

        --blue: #2d70fd;
        --green: #44b858;
        --white: #ffffff;
      }

      body {
        /*background: var(--green);*/
        margin: 2rem;
        /*min-height: 45rem;*/
        height: 85vh;
        display: flex;
        flex-direction: column;
        /*justify-content: space-evenly;*/
        align-items: center;
      }

      .btn {
        color: var(--white);
        font-size: 1rem;
        padding: 0.3rem 0.3rem;
        border-radius: 0.3rem;
        background-color: var(--green);
        border: none;
        position: absolute;
        right: 50%;
        bottom: 0.25rem;
      }

      .nextTenButton {
        color: var(--white);
        font-size: 1rem;
        padding: 0.3rem 0.3rem;
        border-radius: 0.3rem;
        background-color: var(--green);
        border: none;
        position: absolute;
        right: 35%;
        bottom: 0.25rem;
      }

      .clearButton {
        color: var(--white);
        font-size: 1rem;
        padding: 0.3rem 0.3rem;
        border-radius: 0.3rem;
        background-color: var(--green);
        border: none;
        position: absolute;
        right: 18%;
        bottom: 0.25rem;
      }

      .playButton {
        color: var(--white);
        font-size: 1rem;
        padding: 0.3rem 0.3rem;
        border-radius: 0.3rem;
        background-color: var(--green);
        border: none;
        position: absolute;
        right: 5%;
        bottom: 0.25rem;
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6,
      p {
        margin: 0;
      }

      /* Player Container */
      .todo {
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        border-radius: 1rem;
        background: var(--white);
        padding: 1rem;
        height: 80vh;
        width: 100%;
        /*box-shadow: 0 1rem 3rem 1rem rgba(0, 23, 71, 0.15);*/
        max-width: 30rem;
      }

      h2 {
        text-transform: uppercase;
        height: 2rem;
        color: var(--dark);
        text-align: center;
      }

      .playerlists {
        display: flex;
        flex-direction: row;
        width: 10rem;
        /*height: 80vh ;*/
      }

      .input {
        position: relative;
        display: flex;
      }

      .input-field {
        width: 48%;
        border: 0.06rem solid #d2d2d2bf;
        border-radius: 0.5rem;
        padding: 0.5rem;
        font-size: 1rem;
      }

      input[type="text"]::placeholder {
        color: var(--gray);
      }

      .player-container {
        display: flex;
        gap: 1rem;
      }

      ul {
        padding: 0;
        margin: 0;
        overflow-y: scroll;
      }

      li {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        padding: 0.5rem;
      }

      #todoList p {
        display: flex;
        gap: 1rem;
        color: var(--dark);
        align-items: center;
      }

      #currentGameList p {
        display: flex;
        gap: 1rem;
        color: var(--dark);
        align-items: center;
      }

      #todoList .disabled {
        color: var(--green);
      }

      .disabled {
        display: flex;
      }

      input[type="checkbox"] {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        cursor: pointer;
      }

      input[type="checkbox"]::before {
        content: "\2713";
        display: inline-block;
        width: 1rem;
        height: 1rem;
        font-size: 1rem;
        text-align: center;
        border: 0.06rem solid var(--gray-border);
        border-radius: 50%;
        color: transparent;
      }

      input[type="checkbox"]:checked::before {
        color: var(--white);
        background-color: var(--green);
        border: 0.06rem solid var(--green);
        border-radius: 50%;
      }

      .counter {
        border: 0.06rem solid var(--gray-light);
      }

      .counter-container {
        height: 2rem;
        display: flex;
        justify-content: space-between;
      }

      .counter-container p {
        align-self: center;
      }

      .counter-container button {
        border: none;
        background-color: var(--green);
        color: var(--white);
        font-size: 1rem;
        border-radius: 0.3rem;
      }

      .scroll {
        height: 70vh;
        width: 12rem;
        scrollbar-width: thin;
      }

      .scroll::-webkit-scrollbar {
        width: 0.6rem;
      }

      .scroll::-webkit-scrollbar-thumb {
        background-color: var(--green);
        border-radius: 0.5rem;
      }

      .scroll::-webkit-scrollbar-track {
        display: none;
      }
    </style>
    <title>Basketball</title>
  </head>
  <body>
    <section class="todo">
      <h2>Basketball CheckIn</h2>
      <div class="input">
        <input
          type="text"
          class="input-field"
          id="todoInput"
          placeholder="Add a new player"
        />
        <button class="btn">Add</button>
        <button class="nextTenButton">Next</button>
        <button class="clearButton">Clear</button>
        <button class="playButton">Play</button>
      </div>
      <div class="playerlists">
        <div>
          <ul class="scroll">
            <li id="todoList"></li>
          </ul>
        </div>
        <div>
          <ul style="width: 15rem; overflow: hidden">
            <li>Current Game Players</li>
            <li id="currentGameList"></li>
          </ul>
        </div>
      </div>
      <div>
        <hr class="counter" />
        <div class="counter-container">
          <p><span id="playerCount">0</span> players total</p>
          <button id="undoButton">Undo</button>
          <button id="leaveButton">Left</button>
          <button id="leftButton">Show Left</button>
          <button id="resetAllButton">Reset</button>
        </div>
      </div>
    </section>
  </body>
  <script>
    let todo = JSON.parse(localStorage.getItem("todo")) || [];
    let playerBackup = JSON.parse(localStorage.getItem("playerBackup")) || [];
    let playerTemp = JSON.parse(localStorage.getItem("playerTemp")) || [];
    let leave = JSON.parse(localStorage.getItem("leave")) || [];
    const todoInput = document.getElementById("todoInput");
    const todoList = document.getElementById("todoList");
    const currentGameList = document.getElementById("currentGameList");
    const playerCount = document.getElementById("playerCount");
    const addButton = document.querySelector(".btn");
    const nextTenButton = document.querySelector(".nextTenButton");
    const leaveButton = document.getElementById("leaveButton");
    const leftButton = document.getElementById("leftButton");
    const resetAllButton = document.getElementById("resetAllButton");
    const playButton = document.querySelector(".playButton");
    const clearButton = document.getElementById("clearButton");
    const undoButton = document.getElementById("undoButton");

    document.addEventListener("DOMContentLoaded", function () {
      addButton.addEventListener("click", addTask);
      todoInput.addEventListener("keydown", function (event) {
        if (event.key === "Enter") {
          event.preventDefault(); // Prevents default Enter key behavior
          addTask();
        }
      });
      leaveButton.addEventListener("click", leaveAllChecked);
      leftButton.addEventListener("click", showLeft);
      resetAllButton.addEventListener("click", resetAll);
      playButton.addEventListener("click", playGame);
      nextTenButton.addEventListener("click", nextTen);
      clearButton.addEventListener("click", clearChecked);
      undoButton.addEventListener("click", undoTask);
      displayTasks();
    });

    function addTask() {
      const newTask = todoInput.value.trim();
      if (newTask !== "") {
        if (todo.length === 0) {
          todo.push({ text: newTask, disabled: false, gamesPlayed: 0 });
        } else {
          if (todo[todo.length - 1].gamesPlayed === 0) {
            todo.push({ text: newTask, disabled: false, gamesPlayed: 0 });
          } else {
            for (let i = 0; i < todo.length; i++) {
              if (todo[i].gamesPlayed !== 0) {
                todo.splice(i, 0, {
                  text: newTask,
                  disabled: false,
                  gamesPlayed: 0,
                });
                break;
              }
            }
          }
        }
        todoInput.value = "";
        saveToLocalStorage();
        displayTasks();
      }
    }

    function displayTasks() {
      todoList.innerHTML = "";
      todo.forEach((item, index) => {
        const p = document.createElement("p");
        p.innerHTML = `
        <div class="player-container">
          <input type="checkbox" class="todo-checkbox" id="input-${index}" ${
          item.disabled ? "checked" : ""
        }>
          <p id="todo-${index}" class="${
          item.disabled ? "disabled" : ""
        }" onclick="editTask(${index})">${item.text}   ${item.gamesPlayed}</p>
        </div>
      `;
        p.querySelector(".todo-checkbox").addEventListener("change", () =>
          toggleTask(index)
        );
        todoList.appendChild(p);
      });
      playerCount.textContent = todo.length;
    }

    function displayPlayers() {
      currentGameList.innerHTML = "";
      todo.forEach((item, index) => {
        if (todo[index].disabled === true) {
          const p = document.createElement("p");
          p.innerHTML = `
        <div class="player-container">
          <class="todo-checkbox" id="input-${index}">
          <p id="todo-${index}" class="${
            item.disabled ? "disabled" : ""
          }editTask(${index})">${item.text}   ${item.gamesPlayed + 1}</p>
        </div>
      `;
          p.querySelector(".todo-checkbox");
          currentGameList.appendChild(p);
        }
      });
    }

    function editTask(index) {
      const todoItem = document.getElementById(`todo-${index}`);
      const existingText = todo[index].text;
      const inputElement = document.createElement("input");

      inputElement.value = existingText;
      todoItem.replaceWith(inputElement);
      inputElement.focus();

      inputElement.addEventListener("blur", function () {
        const updatedText = inputElement.value.trim();
        if (updatedText) {
          todo[index].text = updatedText;
          saveToLocalStorage();
        }
        displayTasks();
      });
    }

    //for on-click events to change the status of the checkbox and save
    function toggleTask(index) {
      todo[index].disabled = !todo[index].disabled;
      saveToLocalStorage();
      displayTasks();
    }

    //clear the check on any players
    function clearChecked() {
      for (let i = 0; i < todo.length; i++) {
        todo[i].disabled = false;
      }
      saveToLocalStorage();
      displayTasks();
    }

    //select the next 10 players on the list
    function nextTen() {
      clearChecked();
      let maxPlayers = 0;
      if (todo.length < 10) {
        maxPlayers = todo.length;
      } else {
        maxPlayers = 10;
      }
      for (let i = 0; i < maxPlayers; i++) {
        todo[i].disabled = true;
      }
      saveToLocalStorage();
      displayTasks();
    }

    //pulls the data from backup at the sametime replacing the backup with the current player list incase the backup was not really what was required
    function undoTask() {
      playerTemp = [...todo];
      todo = [...playerBackup];
      playerBackup = [...playerTemp];
      saveToLocalStorage();
      displayTasks();
    }

    //creates a backup then copyies the checked players to the right side, then moves the checked players to the bottom of the list unchecked
    function playGame() {
      playerBackup = [...todo];
      displayPlayers();
      for (let i = 0; i < todo.length; i++) {
        if (todo[i].disabled) {
          let copyTodoText = todo[i].text;
          let copyTodoGames = todo[i].gamesPlayed + 1;
          todo.splice(i, 1);
          i--;
          todo.push({
            text: copyTodoText,
            disabled: false,
            gamesPlayed: copyTodoGames,
          });
        }
      }
      saveToLocalStorage();
      displayTasks();
    }

    //copies any checked player to the leave list which are players who do not want to play anymore (potentially could come back in)
    function leaveAllChecked() {
      for (let i = 0; i < todo.length; i++) {
        if (todo[i].disabled) {
          let x = todo[i].text;
          let y = todo[i].gamesPlayed;
          leave.push({ text: x, disabled: false, gamesPlayed: y });
          todo.splice(i, 1);
          i--;
        }
      }
      saveToLocalStorage();
      saveleaveToLocalStorage();
      displayTasks();
    }

    //switch to showing those players that have left (current method is to copy the players to the current list and the current players to leave, button switches to show active
    function showLeft() {
      playerTemp = [...todo];
      todo = [...leave];
      leave = [...playerTemp];
      saveToLocalStorage();
      saveleaveToLocalStorage();
      displayTasks();
      if (leftButton.innerHTML !== "Show Active") {
        nextTenButton.disabled = true;
        nextTenButton.style.backgroundColor = "gray";
        playButton.disabled = true;
        playButton.style.backgroundColor = "gray";
        undoButton.disabled = true;
        undoButton.style.backgroundColor = "gray";
        resetAllButton.disabled = true;
        resetAllButton.style.backgroundColor = "gray";
        addButton.disabled = true;
        addButton.style.backgroundColor = "gray";
        clearButton.disabled = true;
        clearButton.style.backgroundColor = "gray";
        leaveButton.innerHTML = "Mark Active";
        leftButton.innerHTML = "Show Active";
      } else {
        nextTenButton.disabled = false;
        var btncolor = window.getComputedStyle(leaveButton,null).getPropertyValue('background-color')
        nextTenButton.style.backgroundColor = btncolor;
        playButton.disabled = false;
        playButton.style.backgroundColor = btncolor;
        undoButton.disabled = false;
        undoButton.style.backgroundColor = btncolor;
        resetAllButton.disabled = false;
        resetAllButton.style.backgroundColor = btncolor;
        addButton.disabled = false;
        addButton.style.backgroundColor = btncolor;
        clearButton.disabled = false;
        clearButton.style.backgroundColor = btncolor;
        leaveButton.innerHTML = "Mark Left";
        leftButton.innerHTML = "Show Left";
      }
    }

    //resets the two main arrays after making a copy of the current players so it could be undone if pressed by mistake (only if the player list is not erased or this would erase the backup)
    function resetAll() {
      if (todo.length !== 0) {
        playerBackup = [...todo];
        todo = [];
        leave = [];
        saveToLocalStorage();
        saveleaveToLocalStorage();
        displayTasks();
        currentGameList.innerHTML = "";
      }
    }

    //saves the player list
    function saveToLocalStorage() {
      localStorage.setItem("todo", JSON.stringify(todo));
    }

    //saves the player who left or "leave" list
    function saveleaveToLocalStorage() {
      localStorage.setItem("leave", JSON.stringify(leave));
    }
  </script>
</html>
